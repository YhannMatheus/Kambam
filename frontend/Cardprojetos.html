<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanban de Projetos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7f9;
            color: #333;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4361ee;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: #f5f7f9;
            padding: 8px 15px;
            border-radius: 20px;
            width: 300px;
        }

        .search-bar input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            margin-left: 10px;
        }

        .user-actions {
            display: flex;
            align-items: center;
        }

        .user-actions button {
            background-color: #4361ee;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.3s;
        }

        .user-actions button:hover {
            background-color: #3a56d4;
        }

        .kanban-container {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px;
        }

        .column {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 300px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .column-title {
            font-weight: bold;
            font-size: 18px;
        }

        .task-count {
            background-color: #e9ecef;
            color: #6c757d;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 14px;
        }

        .add-task {
            color: #6c757d;
            cursor: pointer;
            font-size: 14px;
        }

        .task {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            cursor: move;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .task:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .task-title {
            font-weight: bold;
            font-size: 16px;
        }

        .task-priority {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 20px;
        }

        .high {
            background-color: #ffe5e5;
            color: #dc3545;
        }

        .medium {
            background-color: #fff3cd;
            color: #856404;
        }

        .low {
            background-color: #d4edda;
            color: #155724;
        }

        .task-description {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-assignee {
            display: flex;
            align-items: center;
        }

        .assignee-avatar {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: #4361ee;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-right: 5px;
        }

        .task-due-date {
            font-size: 12px;
            color: #6c757d;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 500px;
            max-width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .kanban-container {
                flex-direction: column;
            }
            
            .column {
                min-width: 100%;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-bar {
                width: 100%;
            }
            
            .user-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">Quadros de Projetos</div>
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Pesquisar projetos...">
        </div>
        <div class="user-actions">
            <button id="filter-btn"><i class="fas fa-filter"></i> Filtrar</button>
            <button id="new-project-btn"><i class="fas fa-plus"></i> Novo Projeto</button>
        </div>
    </header>

    <div class="kanban-container" id="kanban-container">
        <!-- Colunas e tarefas serão renderizadas dinamicamente aqui -->
    </div>

    <!-- Modal para adicionar/editar projeto -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Novo Projeto</h2>
                <span class="close">&times;</span>
            </div>
            <form id="project-form">
                <div class="form-group">
                    <label for="project-title">Título do Projeto</label>
                    <input type="text" id="project-title" required>
                </div>
                <div class="form-group">
                    <label for="project-description">Descrição</label>
                    <textarea id="project-description"></textarea>
                </div>
                <div class="form-group">
                    <label for="project-priority">Prioridade</label>
                    <select id="project-priority">
                        <option value="high">Alta</option>
                        <option value="medium">Média</option>
                        <option value="low">Baixa</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="project-assignee">Responsável</label>
                    <input type="text" id="project-assignee">
                </div>
                <div class="form-group">
                    <label for="project-due-date">Data de Vencimento</label>
                    <input type="date" id="project-due-date">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn">Cancelar</button>
                    <button type="submit">Salvar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- INTEGRAÇÃO COM BACKEND ---
        const API_BASE = 'http://localhost:3000'; // ajuste se necessário

        // Modal
        const modal = document.getElementById('project-modal');
        const newProjectBtn = document.getElementById('new-project-btn');
        const closeBtn = document.querySelector('.close');
        const cancelBtn = document.querySelector('.cancel-btn');

        newProjectBtn.addEventListener('click', () => {
            modal.style.display = 'flex';
        });
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        cancelBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Renderização dinâmica do Kanban
        async function fetchProjects() {
            const res = await fetch(`${API_BASE}/projects`);
            return res.json();
        }

        async function fetchColumns(projectId) {
            const res = await fetch(`${API_BASE}/projects/${projectId}/columns`);
            return res.json();
        }

        async function fetchTasks(columnId) {
            const res = await fetch(`${API_BASE}/columns/${columnId}/tasks`);
            return res.json();
        }

        async function renderKanban() {
            const kanbanContainer = document.getElementById('kanban-container');
            kanbanContainer.innerHTML = '';
            const projects = await fetchProjects();
            if (!projects.length) {
                kanbanContainer.innerHTML = '<p>Nenhum projeto encontrado.</p>';
                return;
            }
            // Exemplo: renderizar o primeiro projeto
            const project = projects[0];
            const columns = await fetchColumns(project.id);
            for (const column of columns) {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'column';
                columnDiv.innerHTML = `
                    <div class="column-header">
                        <div class="column-title">${column.name}</div>
                        <div class="task-count">0</div>
                    </div>
                    <div class="tasks"></div>
                    <div class="add-task"><i class="fas fa-plus"></i> Adicionar tarefa</div>
                `;
                kanbanContainer.appendChild(columnDiv);
                // Buscar tarefas
                const tasks = await fetchTasks(column.id);
                const tasksDiv = columnDiv.querySelector('.tasks');
                for (const task of tasks) {
                    const taskDiv = document.createElement('div');
                    taskDiv.className = 'task';
                    taskDiv.draggable = true;
                    taskDiv.innerHTML = `
                        <div class="task-header">
                            <div class="task-title">${task.title}</div>
                            <div class="task-priority ${task.priority || 'medium'}">${task.priority ? (task.priority === 'high' ? 'Alta' : task.priority === 'low' ? 'Baixa' : 'Média') : 'Média'}</div>
                        </div>
                        <div class="task-description">${task.description || ''}</div>
                        <div class="task-footer">
                            <div class="task-assignee">
                                <div class="assignee-avatar">${task.assignee ? task.assignee[0] : '?'}</div>
                                <span>${task.assignee || 'Sem responsável'}</span>
                            </div>
                            <div class="task-due-date">${task.dueDate ? new Date(task.dueDate).toLocaleDateString() : ''}</div>
                        </div>
                    `;
                    tasksDiv.appendChild(taskDiv);
                }
                // Atualizar contador
                columnDiv.querySelector('.task-count').textContent = tasks.length;
            }
            addDragAndDrop();
        }

        // Drag and drop (igual ao original)
        function addDragAndDrop() {
            const tasks = document.querySelectorAll('.task');
            const columns = document.querySelectorAll('.column');
            let draggedTask = null;
            tasks.forEach(task => {
                task.addEventListener('dragstart', () => {
                    draggedTask = task;
                    setTimeout(() => {
                        task.style.opacity = '0.5';
                    }, 0);
                });
                task.addEventListener('dragend', () => {
                    setTimeout(() => {
                        draggedTask.style.opacity = '1';
                        draggedTask = null;
                    }, 0);
                });
            });
            columns.forEach(column => {
                column.addEventListener('dragover', e => {
                    e.preventDefault();
                });
                column.addEventListener('dragenter', e => {
                    e.preventDefault();
                    column.style.backgroundColor = '#f0f4ff';
                });
                column.addEventListener('dragleave', () => {
                    column.style.backgroundColor = '#fff';
                });
                column.addEventListener('drop', e => {
                    e.preventDefault();
                    column.style.backgroundColor = '#fff';
                    if (draggedTask) {
                        column.querySelector('.tasks').appendChild(draggedTask);
                        // Aqui você pode fazer uma requisição para atualizar a coluna da tarefa no backend
                        updateTaskCounts();
                    }
                });
            });
        }

        function updateTaskCounts() {
            const columns = document.querySelectorAll('.column');
            columns.forEach(column => {
                const taskCount = column.querySelectorAll('.task').length;
                column.querySelector('.task-count').textContent = taskCount;
            });
        }

        // Adicionar nova tarefa (abrir modal)
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('add-task')) {
                modal.style.display = 'flex';
            }
        });

        // Envio do formulário de novo projeto (exemplo, pode adaptar para tarefa)
        document.getElementById('project-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const title = document.getElementById('project-title').value;
            const description = document.getElementById('project-description').value;
            // Adapte para enviar para o backend
            await fetch(`${API_BASE}/projects`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: title, description })
            });
            modal.style.display = 'none';
            alert('Projeto criado com sucesso!');
            renderKanban();
        });

        // Busca inicial
        renderKanban();
    </script>
</body>
</html>